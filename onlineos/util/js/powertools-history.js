Class.Binds=new Class({$bound:{},bound:function(a){return this.$bound[a]?this.$bound[a]:this.$bound[a]=this[a].bind(this)}});(function(){var c=Element.NativeEvents,a=window.location,e=a.pathname,f=window.history,b=("pushState" in f),d=b?"popstate":"hashchange";this.History=new new Class({Implements:[Class.Binds,Events],initialize:b?function(){c[d]=2;window.addEvent(d,this.bound("pop"))}:function(){c[d]=1;window.addEvent(d,this.bound("pop"));this.hash=a.hash;var g=("onhashchange" in window);if(!(g&&(document.documentMode===undefined||document.documentMode>7))){this.timer=this.check.periodical(200,this)}},push:b?function(g,i,h){if(e&&e!=g){e=null}f.pushState(h||null,i||null,g);this.onChange(g,h)}:function(g){a.hash=g},replace:b?function(g,i,h){f.replaceState(h||null,i||null,g)}:function(g){this.hash="#"+g;this.push(g)},pop:b?function(h){var g=a.pathname;if(g==e){e=null;return}this.onChange(g,h.event.state)}:function(){var g=a.hash;if(this.hash==g){return}this.hash=g;this.onChange(g.substr(1))},onChange:function(g,h){this.fireEvent("change",[g,h||{}])},back:function(){f.back()},forward:function(){f.forward()},getPath:function(){return b?a.pathname:a.hash.substr(1)},hasPushState:function(){return b},check:function(){if(this.hash!=a.hash){this.pop()}}})}).call(this);History.handleInitialState=function(c){if(!c){c=""}var a=window.location,e=a.pathname.substr(c.length),d=a.hash,b=History.hasPushState();if(!b&&e.length>1){window.location=(c||"/")+"#"+e;return true}if(!d||d.length<=1){return false}if(b){(function(){History.push(d.substr(1))}).delay(1);return false}if(!e||e=="/"){return false}window.location=(c||"/")+d;return true};